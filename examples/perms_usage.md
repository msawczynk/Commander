"# Keeper Commander Perms Command Usage\n\nThe `perms` command integrates Simplified Keeper Permissions Automation into Keeper Commander. It provides subcommands for generating templates, validating CSVs, and applying permissions, with options for vault-only operations.\n\n## Features\n- **template**: Generate a CSV template based on your vault's records and teams.\n- **validate**: Validate a CSV file before applying permissions.\n- **apply**: Apply permissions from a CSV file (with optional --dry-run for simulation).\n\nAll data (CSVs, logs) is stored securely in the Keeper vault under a \"Perms Config\" record.\n\n## Introduction\nThe `perms` command is an integration of the Simplified Keeper Permissions Automation tool into Keeper Commander. It automates bulk permission management for Keeper Security vaults using CSV files. Key features include generating templates from your vault data, validating CSVs, and applying permissions by creating folder structures and sharing records to teams.\n\nAll operations are secure: CSVs and logs are stored as attachments in a dedicated \"Perms Config\" record in your vault. This minimizes local file handling and ensures data remains encrypted in Keeper.\n\n## Prerequisites\n- A Keeper Security account with:\n  - Existing records and teams.\n  - Permissions to create folders, share records, and manage attachments.\n- Python 3.6+ and the forked Keeper Commander installed (see Setup).\n- Logged in to Keeper Commander (`keeper login`).\n\n## Setup\n1. Clone the forked repository:\n   ```\n   git clone https://github.com/msawczynk/Commander.git\n   cd Commander\n   ```\n2. Create and activate a virtual environment:\n   ```\n   python -m venv venv\n   venv\\Scripts\\activate\n   ```\n3. Install dependencies:\n   ```\n   pip install -e .\n   ```\n4. Run commands with `python keeper.py perms <subcommand>`.\n\n## Subcommands\n\n### template: Generate CSV Template\n**Usage:**\n```\npython keeper.py perms template <output_csv> [--vault-only]\n```\n- Generates a CSV template populated with your vault's record UIDs, titles, folder paths, and columns for each team.\n- Automatically stores the template as an attachment (e.g., \"Template_2023-10-01T12:00:00.csv\") in the \"Perms Config\" record.\n- **--vault-only**: Skips local file creation; generates in memory and uploads directly to vault.\n\n**Example:**\n```\npython keeper.py perms template my_template.csv\n```\nThis creates `my_template.csv` locally and uploads it.\n\nWith --vault-only:\n```\npython keeper.py perms template --vault-only\n```\nGenerates and stores directly in vault.\n\n### validate: Validate CSV\n**Usage:**\n```\npython keeper.py perms validate <csv_path> [--vault-csv <attachment_title>]\n```\n- Validates the CSV structure (checks existence, basic format).\n- Outputs \"Valid\" or \"Invalid\".\n- **--vault-csv**: Specifies an attachment title in \"Perms Config\"; downloads to temp, validates, deletes temp.\n\n**Example:**\nLocal file:\n```\npython keeper.py perms validate my_template.csv\n```\nVault-stored:\n```\npython keeper.py perms validate --vault-csv \"Template_2023-10-01T12:00:00.csv\"\n```\n\n### apply: Apply Permissions\n**Usage:**\n```\npython keeper.py perms apply <csv_path> [--dry-run] [--interactive] [--root <root_folder>] [--vault-csv <attachment_title>]\n```\n- Applies permissions by creating team-specific folder structures under the root and sharing records with specified permissions.\n- **--dry-run**: Simulates actions without changes (logs what would happen).\n- **--interactive**: Prompts for config folder/record names (default: non-interactive with \"[Perms Config Folder]\" and \"Perms Config\").\n- **--root**: Custom root folder name (default: \"[Perms]\").\n- **--vault-csv**: Downloads CSV from vault by attachment title to temp, applies, deletes temp.\n- If not dry-run, logs actions as an attachment in \"Perms Config\".\n\n**Example:**\nLocal CSV with dry-run:\n```\npython keeper.py perms apply my_permissions.csv --dry-run --root \"[Custom Perms]\"\n```\nVault CSV with interactive prompts:\n```\npython keeper.py perms apply --vault-csv \"MyCSV.csv\" --interactive\n```\n\n## CSV Format\n- **Columns:** Record UID, Title, Folder Path, followed by team names (e.g., TeamA, TeamB).\n- **Permission Levels:** In team columns, specify:\n  - ro: Read-only.\n  - rw: Edit.\n  - rws: Edit + share.\n  - mgr: Manage records.\n  - admin: Full (manage records + users).\n- Empty cells skip that team.\n\n**Sample CSV:**\n```csv\nRecord UID,Title,Folder Path,Admin Team,Dev Team\nabc123,Server Login,/Servers/Prod,ro,rw\ndef456,API Key,/APIs, ,rws\n```\n- Shares \"Server Login\" read-only to Admin Team in /Servers/Prod.\n- Shares \"API Key\" edit+share to Dev Team in /APIs.\n\n## How Permissions Are Applied\n1. Ensures a root folder (e.g., [Perms]).\n2. For each row and non-empty team permission:\n   - Creates team subfolder under root mirroring Folder Path.\n   - Shares record to team folder.\n   - Adds team to shared folder with mapped permissions.\n3. Syncs vault.\n4. Logs if not dry-run.\n\n## Troubleshooting\n- **Attachment Not Found:** Ensure title matches exactly (case-sensitive). List attachments with `get-attachment`.\n- **Permission Errors:** Verify Keeper account has sharing/folder creation rights.\n- **Temp File Issues:** Ensure write permissions in temp dir.\n- **Large CSVs:** May hit limits; split if needed.\n- **Debug:** Use --debug flag on keeper.py for verbose output.\n\n## Limitations\n- Basic validation; add custom checks if needed.\n- Assumes unique team names.\n- Dry-run logs to console, not vault.\n\nFor issues, check the forked repo: [https://github.com/msawczynk/Commander/tree/Perms](https://github.com/msawczynk/Commander/tree/Perms).\n" 